<%= javascript_include_tag "jquery.qtip.min.js" %>
<%= stylesheet_link_tag "jquery.qtip.min.css" %>

<% if current_partner and current_partner.message_for_new_priority %>
    <%= render :partial=>"/shared/top_message_box", :locals=> {:message_text => current_partner.message_for_new_priority.html_safe} %>
<% elsif Government.current.message_for_new_priority and Government.current.message_for_new_priority!="" -%>
    <%= render :partial=>"/shared/top_message_box", :locals=> {:message_text => Government.current.message_for_new_priority.html_safe} %>
<% end %>

<% if params[:notice] %>
    <%= params[:notice] %>
<% end %>

<%= form_for @priority do |f| %>
    <%= f.error_messages %>

    <% if @tag_names %>
        <%= hidden_field_tag :tag_names, @tag_names %>
    <% end %>

    <h3><%= tr("Step 1: Share your new priority", "views/priorities/form") %></h3>

    <div id="your_priority" class="form_header">
      <%= tr("Describe your priority", "views/priorities/form") %>
      <span class="red">*</span>
    </div>
    <div class="tiny_info">
      <em><%= tr("Use a few words to briefly explain your idea.", "views/priorities/form") %></em>
    </div>
    <span class="priority_name">
    <%= f.text_field :name, :size => 60, :maxlength => 60, :autocomplete =>"off" %>
  </span>

    <br><br>

        <div id="priority_category">
          <div class="form_header">
              <%= tr("Select area", "views/priorities/form") %>
              <span class="red">*</span><br>
              <div class="tiny_info">
                <em><%= tr("Choose the local area that your priority will most benefit.", "views/priorities/form") %></em>
            <select name="local">
            <option value="Burlington">Burlington</option>
            <option value="Graham">Graham</option>
            <option value="Mebane">Mebane</option>
            <option value="Elon">Elon</option>
            <option value="Gibsonville">Gibsonville</option>
            <option value="alamance County">Alamance County</option>
            </select>
              </div>
          </div>

        </div>

    <% if current_partner and current_partner.required_tags %>
        <div id="priority_category">
          <div class="form_header">
            <%= tr("Select priority type", "views/priorities/form") %>
            <span class="red">*</span><br>
          </div>
          <% first_tag = true %>
          <% current_partner.required_tags.split(',').each do |partner_tag| %>
              <%= f.radio_button :priority_type, partner_tag, checked: first_tag %>
              <span class="Chapter_name"><%= tr(partner_tag, "views/priorities/form") %></span>
              <% first_tag = false %>
          <% end %>
        </div>
    <% end %>


    <% if current_partner and Government.current.layout=="better_reykjavik" %>
        <input type="hidden" name="priority[category_id]" value="14">
    <% else %>
        <div id="priority_category">
          <div class="form_header">
            <%= tr("Select category", "views/priorities/form") %>
            <span class="red">*</span><br>
            <div class="tiny_info">
              <em><%= tr("Select the most relevant category for your priority. You can add additional categories below.", "views/priorities/form") %></em>
            </div>

          </div>

          <% Category.for_partner.each do |category| %>
              <%= f.radio_button :category_id, category.id %>
              <span class="Chapter_name" id="category_<%= category.id %>"><%= category.i18n_name %></span>
              <span class="invisible" id="category_<%= category.id %>_text"><%= tr(category.description, "Description from database") %></span>
          <% end %>
        </div>

        

        <br>

        <div class="form_header">
          <%= tr("Provide your own categories (separated by comma)", "views/priorities/form") %>
          <div class="tiny_info">
              <em><%= tr("Examples include jobs, parks, or transportation.", "views/priorities/form") %></em>
          </div>
        </div>

        <span class="custom_tag">
    <%= text_field_tag :custom_tags, "", :maxlength => 200 %>
  </span>

        <br/>
        <br/>
    <% end %>
    <hr/>
    <h3><%= tr("Step 2: Add a point that supports your priority", "views/priorities/form") %></h3>
    <div class="form_header">
      <%= tr("Add a point", "views/priorities/form") %>
      <span class="red">*</span>
      <div class="tiny_info"><em>
              <%= tr("Provide a brief title that captures your point.", "views/priorities/form") %>
      </em>
      </div>
    </div>

    <%= f.fields_for(:points) do |point_form| %>
        <div class="field">
          <div class="field_box">
            <%= point_form.text_field :name, :size => 60, :maxlength => 60 %>
          </div>
          <div class="field_label">

          </div>
        </div>
        <br>
        <div class="field">
          <div class="field_label form_header">
            <%= tr("Explain your point.", "view/priorities/_form") %>
            <span class="characters"><span id="pointContentDown"></span> <%= tr("characters left", "view/priorities/_form") %></span>
            <span class="red">*</span>
             <div class="tiny_info"><em>
              <%= tr("Explain your point in a few sentences to help convince others that your priority is important.", "views/priorities/form") %>
              </em>
              </div>
          </div>
          <div class="field_box">
            <%= point_form.text_area :content, :id => 'pointContent', :button => 'submit', :rows => 5, :cols => 60, :maxLength => 500 %>
            <input type="hidden" id="priority_points_attributes_0_value_1" name="priority[points_attributes][0][value]" value="1">
          </div>

        </div>

        <br>

        <div class="field">
          <div class="form_header">
            <%= tr("Add a link to an external website", "views/priorities/form") %>
              <div class="tiny_info"><em>
              <%= tr("Provide a link that provides more information, such as a <a href='http://thetimesnews.com'> Burlington Times-News</a> story.", "views/priorities/form") %>
      </em>
      </div>
          </div>
          <div class="field_box">
            <%= point_form.text_field :website, :size => 50 %>
          </div>
        </div>

    <% end %>

    <br>

    <b><%= submit_tag tr("Create priority", "view/priorities/_form"), :class => "submit_button" %></b>
<% end %>

<script type="text/javascript">
    $(function() {
        $('.Chapter_name').each(
                function() {
                    var category_id = $(this).attr("id");
                    var tooltip_text = $('#' + category_id + '_text').html();
                    if (tooltip_text) {
                        $(this).qtip({
                            content: tooltip_text,
                            show: { delay: 300 },
                            hide: { delay: 500, fixed: true }
                        })
                    }
                }
        )
    });
</script>
